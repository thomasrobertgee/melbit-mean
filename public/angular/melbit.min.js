(function(){angular.module("melbitApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,t){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode(true)}angular.module("melbitApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("melbitApp").controller("homeCtrl",e);e.$inject=["$scope","melbitData","geolocation"];function e(e,t,o){var n=this;n.pageHeader={title:"Melbit",strapline:"Find places to spend Bitcoin near you!"};n.sidebar={content:"looking for wifi and a seat and some coffee"};n.message="Checking your location";n.getData=function(e){var o=e.coords.latitude,r=e.coords.longitude;n.message="Searching for nearby places";t.locationByCoords(o,r).success(function(e){n.message=e.length>0?"":"No locations found nearby";n.data={locations:e};console.log(n.data)}).error(function(e){n.message="Sorry, something's gone wrong, please try again later"})};n.showError=function(t){e.$apply(function(){n.message=t.message})};n.noGeo=function(){e.$apply(function(){n.message="Geolocation is not supported by this browser."})};o.getPosition(n.getData,n.showError,n.noGeo)}})();(function(){angular.module("melbitApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About Melbit"};e.main={content:"Melbit was created to help people find businesses in Melbourne that accept Bitcoin. The saints food bloggers, moomba the bulldogs the australian open carlton tullamarine, bill clinton ate two bowls hu tong dumplings the espy swanston footscray hobos, ticket inspector bespectacled girls north of the river MSAC secret laneway bars, formula one grand prix cold drip coffee old melbourne gaol. \n\nThe saints, laksa king spring racing carnival old melbourne gaol rooftop bars flemington racecourse, mamasita emerald peacock lions bar kath and kim ac/dc, south of the river tullamarine trams swanston secret laneway bars, hipsters neatly trimmed moustaches melb."}}})();(function(){angular.module("melbitApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Sign in to Melbit"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";t.login(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("melbitApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.pageHeader={title:"Create a new Melbit account"};o.credentials={name:"",email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";t.register(o.credentials).error(function(e){o.formError=e}).then(function(){e.search("page",null);e.path(o.returnPage)})}}})();(function(){angular.module("melbitApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$location","$modal","melbitData","authentication"];function e(e,t,o,n,r){var a=this;a.locationid=e.locationid;a.isLoggedIn=r.isLoggedIn();a.currentPath=t.path();n.locationById(a.locationid).success(function(e){a.data={location:e};a.pageHeader={title:a.data.location.name}}).error(function(e){console.log(e)});a.popupReviewForm=function(){var e=o.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:a.locationid,locationName:a.data.location.name}}}});e.result.then(function(e){a.data.location.reviews.push(e)})}}})();(function(){angular.module("melbitApp").controller("reviewModalCtrl",e);e.$inject=["$modalInstance","locationData"];function e(e,t){var o=this;o.locationData=t;o.onSubmit=function(){o.formError="";if(!o.formData.name||!o.formData.rating||!o.formData.reviewText){o.formError="All fields required, please try again";return false}else{o.doAddReview(o.locationData.locationid,o.formData)}};o.doAddReview=function(e,t){melbitData.addReviewById(e,{author:t.name,rating:t.rating,reviewText:t.reviewText}).success(function(e){o.modal.close(e)}).error(function(e){o.formError="Your review has not been saved, try again"});return false};o.modal={close:function(t){e.close(t)},cancel:function(){e.dismiss("cancel")}}}})();(function(){angular.module("melbitApp").service("authentication",e);e.$inject=["$window"];function e(e){var t=function(t){e.localStorage["melbit-token"]=t};var o=function(){return e.localStorage["melbit-token"]};register=function(e){return $http.post("/api/register",e).success(function(e){t(e.token)})};login=function(e){return $http.post("/api/login",e).success(function(e){t(e.token)})};logout=function(){e.localStorage.removeItem("melbit-token")};var n=function(){var t=o();if(t){var n=JSON.parse(e.atob(t.split(".")[1]));return n.exp>Date.now()/1e3}else{return false}};var r=function(){if(n()){var t=o();var r=JSON.parse(e.atob(t.split(".")[1]));return{email:r.email,name:r.name}}};return{saveToken:t,getToken:o}}})();(function(){angular.module("melbitApp").service("geolocation",e);function e(){var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}}})();(function(){angular.module("melbitApp").service("melbitData",e);e.$inject=["$http","authentication"];function e(e,t){var o=function(t,o){return e.get("/api/locations?lng="+o+"&lat="+t+"&maxDistance=20")};var n=function(t){return e.get("/api/locations/"+t)};var r=function(t,o){return e.post("/api/locations/"+t+"/reviews",o)};return{locationByCoords:o,locationById:n,addReviewById:r}}})();(function(){angular.module("melbitApp").filter("formatDistance",t);var e=function(e){return!isNan(parseFloat(e))&&isFinite(e)};function t(){return function(t){var o,n;if(t&&e(t)){if(t>1){o=parseFloat(t).toFixed(1);n="km"}else{o=parseInt(t*1e3,10);n="m"}return o+n}else{return"?"}}}})();(function(){angular.module("melbitApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br/>");return t}}})();(function(){angular.module("melbitApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,t){var o=this;o.currentPath=e.path();o.isLoggedIn=t.isLoggedIn();o.currentUser=t.currentUser();o.logout=function(){t.logout();e.path("/")}}})();(function(){angular.module("melbitApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("melbitApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("melbitApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("melbitApp").directive("ratingStars",e);function e(){return{restrict:"EA",scope:{thisRating:"=rating"},templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();